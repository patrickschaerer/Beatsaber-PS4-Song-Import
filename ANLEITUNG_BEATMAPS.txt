# Anleitung: PS4 Beat Saber Beatmaps ersetzen

Diese Anleitung beschreibt den erfolgreichen Prozess zum Ersetzen von Beatmap-Dateien in einem PS4 Beat Saber AssetBundle mit UABEA.

**Ausgangslage:**
- PC/Quest `.dat`-Dateien für die Custom Map (z.B., `Hard.dat`, `Expert.dat`).
- Das Ziel-AssetBundle (z.B. `ugh` oder `sharedassetsX.assets`), das den zu ersetzenden Song enthält.

---

### Schritt 1: Beatmap-Dateien komprimieren (Gzip)

Die `.dat`-Dateien müssen zuerst mit dem Gzip-Algorithmus komprimiert werden.

**Vorgehen:**
1. Verwende das Skript `gzip_beatmaps.py` (im `Tools`-Ordner).
2. Das Skript nimmt einen Ordner als Eingabe (z.B. `BootySwing_extracted`).
3. Es komprimiert alle `.dat`-Dateien in diesem Ordner und erstellt entsprechende `gz<Dateiname>.dat`-Dateien (z.B. `gzHard.dat`).

---

### Schritt 2: UABEA-Header voranstellen (Der entscheidende Schritt)

UABEA erwartet beim "Import raw" für `TextAsset`-Beatmaps nicht nur die reinen Gzip-Daten, sondern einen speziellen Header vor den Gzip-Daten.

**Vorgehen:**
1. Verwende das Skript `prepend_header.py` (im `Tools`-Ordner).
2. Das Skript benötigt drei Argumente:
   - Die komprimierte Gzip-Datei aus Schritt 1 (z.B. `gzHard.dat`).
   - Den Namen der neuen Ausgabedatei (z.B. `Hard_formatted.dat`).
   - Einen internen Dateinamen, der in den Header geschrieben wird (z.B. "BootySwingHard.beatmap.gz").
3. Das Skript erstellt eine neue Datei (`Hard_formatted.dat`), die jetzt mit dem korrekten Header beginnt, gefolgt von den Gzip-Daten.

**Struktur des Headers (zur Information):**
- 4 Bytes: Länge des internen Dateinamens.
- `n` Bytes: Der interne Dateiname als String.
- `x` Bytes: Padding-Bytes (Null-Bytes), um auf eine 4-Byte-Grenze auszurichten.
- 4 Bytes: Die Größe der folgenden Gzip-Daten.

---

### Schritt 3: Import in UABEA

Jetzt kann die korrekt formatierte Datei in UABEA importiert werden.

**Vorgehen:**
1. Öffne das Ziel-AssetBundle in UABEA.
2. Finde das `TextAsset`, das du ersetzen möchtest (z.B. `UghHard.beatmap.gz`).
3. Wähle es aus und gehe im Menü auf **Plugins > Import raw**.
4. Wähle die in Schritt 2 erstellte, formatierte Datei aus (z.B. `Hard_formatted.dat`).
5. Wiederhole dies für alle Schwierigkeitsgrade, die du ersetzen möchtest.

---

### Schritt 4: Speichern

1. Speichere das modifizierte AssetBundle über **File > Save**.
2. Wähle einen neuen Speicherort oder Namen, um die Originaldatei nicht zu überschreiben.

Diese neue Asset-Datei kann nun für das Erstellen des finalen PKG-Pakets verwendet werden.
